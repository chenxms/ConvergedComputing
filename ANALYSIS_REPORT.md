# 学业发展质量监测统计分析服务详细分析报告

## 1. 数据库分析

### 1.1 主要数据表结构

**核心表关系：**
- **grade_aggregation_main (批次主表)**：记录每个批次的基本信息，包含年级级别和科目列表
- **batch_dimension_definition (批次维度定义表)**：定义每个批次下各科目的维度结构（一级维度、二级维度）
- **subject_question_config (题目配置表)**：存储每个题目的基本信息和满分值
- **question_dimension_mapping (题目维度映射表)**：建立题目与维度的关联关系
- **student_score_detail (学生成绩明细表)**：存储每个学生在各题目的原始分数
- **statistical_aggregations (统计汇聚主表)**：存储计算后的统计结果（区域级和学校级）
- **student_cleaned_scores (清洗后成绩表)**：存储经过数据清洗和预处理后的学生分数数据

### 1.2 数据表关系

```
批次主表 → 批次维度定义表
           ↓
题目配置表 → 题目维度映射表 → 学生成绩明细表 → 清洗后成绩表 → 统计汇聚表
```

数据流向：原始数据（student_score_detail）→ 数据清洗（student_cleaned_scores）→ 统计计算 → 结果存储（statistical_aggregations）

## 2. 数据清洗和预计算分析

### 2.1 数据清洗过程
项目通过`student_cleaned_scores`表实现数据清洗：
- 从`student_score_detail`表获取原始数据
- 对数据进行验证和清理（去除无效值、处理缺失数据等）
- 计算每个学生每个科目的总分和满分
- 计算每个学生每个维度的分数和维度满分
- 将清洗后的数据存储到`student_cleaned_scores`表中

### 2.2 预计算内容
清洗后的数据包含以下预计算字段：
- **total_score**: 学生在该科目的总分
- **max_score**: 该科目的满分
- **dimension_scores**: 各维度得分的JSON格式数据
- **dimension_max_scores**: 各维度满分的JSON格式数据
- **is_valid**: 数据有效性标记

这些预计算数据为后续的统计汇聚提供了基础，避免了在汇聚时重复计算。

## 3. 数据汇聚方法和流程

### 3.1 区域级数据汇聚
区域级数据汇聚流程：
1. 从`student_cleaned_scores`表获取批次内所有学生数据
2. 按科目分组进行统计计算
3. 计算各科目的基础统计指标（平均分、标准差、难度系数等）
4. 计算等级分布（根据小学/初中不同标准）
5. 计算百分位数（P10、P50、P90）
6. 计算区分度（前27%/后27%分组）
7. 计算各维度的统计指标
8. 生成学校排名
9. 将结果存储到`statistical_aggregations`表中（aggregation_level = 'regional'）

### 3.2 学校级数据汇聚
学校级数据汇聚流程：
1. 从`student_cleaned_scores`表获取指定学校的学生数据
2. 按科目分组进行统计计算
3. 计算学校在各科目的统计指标
4. 计算与区域平均值的对比数据
5. 将结果存储到`statistical_aggregations`表中（aggregation_level = 'school'）

### 3.3 问卷类科目处理
问卷类科目的处理流程：
1. **量表转换**：根据题目类型（正向/反向）进行分数转换
   - 正向量表：1→1, 2→2, 3→3, 4→4, 5→5
   - 反向量表：1→5, 2→4, 3→3, 4→2, 5→1
2. **频率分析**：计算各选项的选择频率和百分比分布
3. **维度汇总**：计算各维度的平均分、得分率等统计指标
4. **质量检查**：检测直线响应、异常响应模式等数据质量问题
5. **选项占比计算**：计算各选项（非常同意、同意、不同意、非常不同意）的选择比例

项目已实现问卷类科目的完整处理流程，能够准确计算维度情况和各题目的选项占比，符合用户需求。

## 4. 结论

当前项目架构设计合理，数据处理流程清晰：
1. 数据库表结构完整，能够支持教育统计分析的各项需求
2. 数据清洗和预计算机制有效，为后续统计汇聚提供了高质量的基础数据
3. 区域级和学校级数据汇聚流程完整，计算指标全面
4. 问卷类科目处理功能完善，能够准确计算维度统计和选项占比

项目已实现用户要求的所有核心功能，数据汇聚能够准确达成目的。建议在实际使用中重点关注数据质量验证和性能优化方面的工作。